# Environment-specific config
@edsc.config = do (window, env='<%= Rails.env %>') ->

  csrfToken = document.querySelector?('meta[name=csrf-token]')?.content

  <% if Rails.env.test? %>

  #window.onerror = (message, filename, lineno, colno, e) ->
  #  console.error "#{message} [#{filename}:#{lineno}]"
  #  false

  # Test config
  exports =
    urlLimit: 120
    defaultAnimationDurationMs: 0
    xhrRateLimitMs: 100
    maxPolygonSize: 50
    csrfToken: csrfToken
    hoverTimeoutMs: 0
    gibsUrl: "/assets/gibs-example.jpeg?{timeparam}SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={product}&STYLE=&TILEMATRIXSET={projection}_{resolution}&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT=image%2F{format}{extra}"
    browseScalerUrl: "/assets/gibs-example.jpeg#"
    present: -> Date.UTC(2014, 2, 1)

  <% elsif Rails.env.development? %>

  # Development config
  exports =
    urlLimit: 200
    defaultAnimationDurationMs: 300
    xhrRateLimitMs: 500
    maxPolygonSize: 50
    csrfToken: csrfToken
    hoverTimeoutMs: 500
    debug: true
    gibsUrl: 'https://map1{s}.vis.earthdata.nasa.gov/wmts-{endpoint}/wmts.cgi?{timeparam}SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={product}&STYLE=&TILEMATRIXSET={projection}_{resolution}&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT=image%2F{format}{extra}'
    browseScalerUrl: "https://api.echo.nasa.gov/browse-scaler/browse_images/granules"
    present: -> new Date() - 0

  <% else %>
  # Production config
  exports =
    urlLimit: 2000
    defaultAnimationDurationMs: 300
    xhrRateLimitMs: 500
    maxPolygonSize: 50
    csrfToken: csrfToken
    hoverTimeoutMs: 500
    gibsUrl: 'https://map1{s}.vis.earthdata.nasa.gov/wmts-{endpoint}/wmts.cgi?{timeparam}SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={product}&STYLE=&TILEMATRIXSET={projection}_{resolution}&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT=image%2F{format}{extra}'
    browseScalerUrl: "https://api.echo.nasa.gov/browse-scaler/browse_images/granules"
    present: -> new Date() - 0

  <% end %>
