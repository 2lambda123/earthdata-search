setup_auth_curl() {
    status=$(curl -w "%{http_code}" -XHEAD -s -b "$cookie_jar" -c "$cookie_jar" \
                  <%= raw @urls.first %>)
    if [ "$status" -ne "200" && "$status" -ne "304" ]; then
        status=$(curl -w "%{http_code}" -XHEAD -s -b "$cookie_jar" -c "$cookie_jar" -L \
                      --max-redirs 2 --netrc-file "$netrc" <%= raw @urls.first %>)
        if [ "$status" -ne "302" ]; then exit_bad_login; fi
    fi
}

setup_auth_wget() {
    # The safest way to auth via curl is netrc. Note: there's no checking or feedback
    # if login is unsuccessful
    touch ~/.netrc
    chmod 0600 ~/.netrc
    credentials=$(grep 'machine urs.earthdata.nasa.gov' ~/.netrc)
    if [ -z "$credentials" ]; then
        cat "$netrc" >> ~/.netrc
    fi
}

detect_user_approval() {
    approved=`curl -s -b ~/.urs_cookies -c ~/.urs_cookies -L --max-redirs 2 -n <%= raw @urls.first %> -w %{http_code} | tail  -1`
    if [ "$approved" -ne "302" ]; then
        # User didn't approve the app. Direct users to approve the app in URS
        echo "\nERROR: this is your first time retrieving data from this provider using Earthdata Login credentials. You will need to authorize the provider's web service (application) in Earthdata Login GUI before running this script again."
        exit
    fi
}
